{% extends 'base.html' %}
{% load static %}

{% block title %}
    Nuevo Ticket
{% endblock %}

{% block content %}

    <div class="container mt-4">
        <div class="card card-primary">

            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-headset mr-2"></i>
                    Registrar Ticket de Soporte
                </h3>
            </div>

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="card-body">

                    <div class="form-group">
                        <label>Título</label>
                        {{ form.titulo }}
                    </div>

                    <div class="form-group">
                        <label>Descripción</label>
                        {{ form.descripcion }}
                    </div>

                    <div class="row">

                        <div class="col-md-6">
                            <label>Categoría</label>
                            {{ form.categoria }}
                        </div>

                        <div class="col-md-6">
                            <label>Prioridad</label>
                            {{ form.prioridad }}
                        </div>

                    </div>
                </div>

                <div class="card-footer text-right">
                    <a href="{% url 'kardex:ticket_listado' %}" class="btn btn-warning mx-2">
                        Mis Tickets
                    </a>
                    <button class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i>
                        Enviar Ticket
                    </button>
                </div>

            </form>

        </div>
    </div>

{% endblock %}

{% block javascript %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const allowedExtensions = [
                "pdf",

                "doc", "docx",
                "xls", "xlsx",

                "png", "jpg", "jpeg", "gif", "webp"
            ];

            document.querySelectorAll('.custom-file-input').forEach(function (input) {

                input.addEventListener('change', function (e) {

                    if (!e.target.files.length) return;

                    const file = e.target.files[0];
                    const fileName = file.name;
                    const extension = fileName.split('.').pop().toLowerCase();

                    // Validar extension
                    if (!allowedExtensions.includes(extension)) {

                        // Vaciar input
                        e.target.value = "";

                        // Reset label
                        e.target.nextElementSibling.innerHTML = "Seleccionar archivo";

                        // Mostrar alerta
                        Swal.fire({
                            icon: "error",
                            title: "Archivo no permitido",
                            html: `
                        <b>Tipo de archivo rechazado:</b> .${extension}<br><br>
                        <b>Permitidos:</b><br>
                        PDF, Word, Excel e imágenes (PNG, JPG, WEBP)
                    `,
                            confirmButtonText: "Entendido",
                        });

                        return;
                    }

                    // ✅ Si pasa validación mostrar nombre
                    e.target.nextElementSibling.innerHTML = fileName;

                });

            });

        });
    </script>


{% endblock %}
